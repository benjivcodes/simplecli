#!/usr/bin/env bash
# A simple command line based extensible toolchain for MacOS.

bash_source="${BASH_SOURCE[0]}"
if [[ -h $bash_source ]]; then
  bash_source="$(readlink "$bash_source")"
fi

bold=$(tput bold)
normal=$(tput sgr0)
cli_lib="/usr/local/lib/simplecli"
command_dir="${cli_lib}/commands"
available_commands=()

function source_commands(){
  for c in $(/bin/ls ${command_dir}); do
    available_commands+=("${c}")
  done

  for f in "${command_dir}"/*; do
    source "$f"
  done
}

function handle_command(){
  source_commands

  if [[ $# -lt 1 ]]; then
    usage
  else
    command="$1"
    shift
    "${command}"_handle "$@"
  fi
}

function usage(){
  echo -e " "
  echo -e "  usage: $(basename "$0") <command> <subcommand> [parameters]\n"
  echo -e "  To see help text, you can run:\n"
  echo -e "  cli help"
  echo -e "  cli <command> help"
  echo -e "  cli <subcommand> help"
  echo -e " "
}

function help(){
  echo -e  "\n A simple command line based extensible toolchain for MacOS."
  echo -e "\n AVAILABLE COMMANDS$\n"

  source_commands
  for command in "${available_commands[@]}"; do
    echo -e "  ${command} :::: $(${command}_description)"
  done
   echo ""
}

command="$1"
case $command in
  help)
    help
  ;;
  
  *)
    handle_command "$@"
  ;;
esac
