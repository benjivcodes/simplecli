#!/usr/bin/env bash
# Wrapper for Homebrew on MacOS

function brew_description(){
    echo "Homebrew toolchain for macOS"
}

function brew_help(){
  echo -e "\n usage: $(basename "$0") homebrew <subcommand>"
  echo -e "\n AVAILABLE SUBCOMMANDS:\n"
  echo " bootstrap   Install Homebrew with a base set of options and tools"
  echo " fix         Attempt to fix anything that has gone wrong"
  echo " remove      Remove Homebrew from the system"
  echo " update      Update and cleanup the Homebrew installation"
  echo " multiuser   Attempt to make Homebrew multiuser"
  echo " help        this message"
	echo ""
}

function brew_handle(){
  command="$1"

  case $command in
  install)
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
  ;;

  bootstrap)
    for p in $(cat "${CLIHOME}/brew_bootstrap_packages.txt")
    do
      brew install "${p}"
    done

    brew cask install android-sdk
    brew cask install android-platform-tools
    brew cask install java
  ;;

  fix)
    pushd +0 . || exit 1
    cd /usr/local || exit 1
    git remote add origin git://github.com/mxcl/homebrew.git > /dev/null 2>&1
    git fetch origin > /dev/null 2>&1
    git reset --hard origin/master > /dev/null 2>&1
    brew update > /dev/null 2>&1
    popd || exit 1
  ;;

  remove)
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)"
  ;;

  update)
    brew update > /dev/null 2>&1
    brew upgrade > /dev/null 2>&1
    brew cleanup
  ;;

  multiuser)
    echo -e "\nYou will need to add users to the group 'admin'"
    sudo chgrp -R admin /opt /usr/local/* /Library/Caches/Homebrew
    sudo chmod -R g+w /opt /usr/local/* /Library/Caches/Homebrew
  ;;

  help)
		brew_help
	;;

  *)
    brew_help
  ;;
  esac
}
